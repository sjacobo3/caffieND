{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}

<div class="text-center mb-4">
    <h1 class="title">CaffieND!</h1>
</div>

<form action="/" method="GET" class="mb-4">
    <div class="row">
        <!-- filters -->
        <div class="col-md-3">
            <h5>Filters:</h5>
            <!-- calories -->
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="low_cal" {% if
                    request.args.get('low_cal')%}checked{% endif %}>
                <label class="form-check-label">Low Calories</label>
            </div>
            <!-- caffeine -->
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="low_caffeine" {% if
                    request.args.get('low_caffeine')%}checked{% endif %}>
                <label class="form-check-label">Low Caffeine</label>
            </div>

            <button class="btn btn-secondary w-100 mt-3 mb-5" type="submit">Apply Filters</button>
        </div>

        <!-- main content -->
        <div class="col-md-9">
            <!-- search bar -->
            <div class="input-group mb-3">
                <input type="text" class="form-control" name="q" placeholder="Search for a drink..."
                    value="{{ request.args.get('q', '') }}">
                <button class="btn btn-primary" type="submit">Search</button>
            </div>

            <!-- Drink Cards -->
            <div class="row justify-content-center">
                {% for drink in drinks %}
                <div class="col-12 col-sm-6 col-md-3 mb-4">
                    <div class="card shadow-sm border-0 h-100" style="cursor:pointer;" data-bs-toggle="modal"
                        data-bs-target="#drinkModal-{{ drink.drink_id }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ drink.name }}</h5>
                            <p class="card-text mb-1"><strong>Volume:</strong> {{ drink.volume }}</p>
                            <p class="card-text mb-1"><strong>Calories:</strong> {{ drink.calories }}</p>
                            <p class="card-text mb-1"><strong>Amount:</strong> {{ drink.caffeine_amt }}</p>
                            <!-- <p class="card-text mb-1"><strong>Type:</strong> {{ drink.caffeine_type }}</p> -->
                        </div>
                    </div>

                    <!-- Modal for each drink -->
                    <div class="modal fade" id="drinkModal-{{ drink.drink_id }}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h5 class="modal-title">{{ drink.name }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>

                                <!-- Modal Body -->
                                <div class="modal-body">

                                    <!-- Favorites -->
                                    {% if drink.drink_id in user_favorites %}
                                    <form action="{{ url_for('remove_favorite') }}" method="POST" class="mb-3">
                                        <input type="hidden" name="drink_id" value="{{ drink.drink_id }}">
                                        <!-- remove from favorites -->
                                        <button class="btn btn-secondary w-100" type="submit">☆ Remove from
                                            Favorites</button>
                                    </form>
                                    {% else %}
                                    <form action="{{ url_for('add_favorite') }}" method="POST" class="mb-3">
                                        <input type="hidden" name="drink_id" value="{{ drink.drink_id }}">
                                        <!-- add to favorites -->
                                        <button class="btn btn-warning w-100" type="submit">★ Add to Favorites</button>
                                    </form>
                                    {% endif %}

                                    <hr>

                                    <!-- Log Drink Form -->
                                    <form action="{{ url_for('log_drink') }}" method="POST">
                                        <input type="hidden" name="drink_id" value="{{ drink.drink_id }}">

                                        <div class="mb-3">
                                            <label for="drink_ml-{{ drink.drink_id }}" class="form-label">Amount
                                                consumed
                                                (mL)</label>
                                            <input type="number" class="form-control" id="drink_ml-{{ drink.drink_id }}"
                                                name="drink_ml" required min="1">
                                        </div>

                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-success">✓ Log This Drink</button>
                                        </div>
                                    </form>

                                </div>

                                <!-- Modal Footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- End Modal -->

                </div>
                {% endfor %}
            </div>
        </div>
</form>

<!-- Pagination -->
<nav>
    <ul class="pagination justify-content-center mt-4">

        {% if pagination.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('home', page=pagination.prev_num) }}">Previous</a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
        {% if p == pagination.page %}
        <li class="page-item active"><span class="page-link">{{ p }}</span></li>
        {% else %}
        <li class="page-item"><a class="page-link" href="{{ url_for('home', page=p) }}">{{ p }}</a></li>
        {% endif %}
        {% else %}
        <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
        <li class="page-item"><a class="page-link" href="{{ url_for('home', page=pagination.next_num) }}">Next</a></li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}

    </ul>
</nav>

{% endblock %}